<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Buscar Candidato</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
    integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-Fy6S3B9q64WdZWQUiU+q4/2Lc9npb8tCaSX9FK7E8HnRr0Jz8D6OP9dO5Vg3Q9ct"
    crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
    <!-- jQuery primeiro -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" crossorigin="anonymous"></script>
</head>
<body>
  <h2>Buscar candidato</h2>

  <form id="formCandidato">
  <input type="text" id="nickInput" placeholder="Digite o nick do candidato">
  <button id="buscarBtn" type="submit">Buscar</button>

  <pre id="resultado"></pre>
  </form>
  <div id="mensagem" class="mt-3"></div>
  <script>
    document.getElementById("nickInput").addEventListener("blur", function(){
        alert("saiu");
    });

    $(document).ready(function () {
    $("#formCandidato").on("submit", function (event) {
        event.preventDefault();

        let candidato = {
            nick: $("#nickInput").val().trim()
        };

        console.log("Enviando candidato:", candidato);
        checaNick(candidato);
    });
});

function checaNick(candidato) {
    $.ajax({
        url: "http://10.4.5.202:5000/candidatos/buscar",
        type: "POST",
        contentType: "application/json",  // enviando JSON
        dataType: "json",                 // esperando JSON
        data: JSON.stringify(candidato),
        success: function (response) {
            console.log("Resposta da API:", response);

            // Verifica se veio algum candidato
            if (response && response.length > 0) {
                let c = response[0]; // pega o primeiro candidato
                let msg = `
                    <strong>Candidato encontrado!</strong><br>
                    Nome: ${c.nomeCompleto}<br>
                    Nick: ${c.nick}<br>
                    Matrícula: ${c.matriculaIFG}<br>
                    Tipo: ${c.tipo}
                `;

                $("#mensagem").html('<div class="alert alert-success">' + msg + '</div>');
                $("#mensagem").attr("tabindex", "-1").focus();
                $("#formCandidato")[0].reset();

                alert("Candidato encontrado: " + c.nomeCompleto);
            } else {
                $("#mensagem").html('<div class="alert alert-warning">Nenhum candidato encontrado.</div>');
            }
        },
        error: function (xhr) {
            console.error("Erro:", xhr);

            let erroMsg = "Erro ao buscar candidato.";
            if (xhr.responseJSON && xhr.responseJSON.message) {
                erroMsg = xhr.responseJSON.message;
            }

            $("#mensagem").html('<div class="alert alert-danger">' + erroMsg + '</div>');
        }
    });
}

    document.getElementById("buscarBtneeee").addEventListener("click", async () => {
      const nick = document.getElementById("nickInput").value.trim();
      const resultadoEl = document.getElementById("resultado");

      // Limpa a saída anterior
      resultadoEl.textContent = "Buscando...";

      if (!nick) {
        resultadoEl.textContent = "Por favor, insira um nick.";
        return;
      }

      try {
        const response = await fetch("http://192.168.0.3:5000/candidatos/buscar", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ nick })
        });

        if (!response.ok) {
          throw new Error(`Erro HTTP: ${response.status}`);
        }

        const data = await response.json();

        if (Object.keys(data).length === 0) {
          resultadoEl.textContent = "Nenhum candidato encontrado.";
        } else {
          resultadoEl.textContent = JSON.stringify(data, null, 2);
        }
      } catch (error) {
        resultadoEl.textContent = `Erro ao buscar candidato: ${error.message}`;
      }
    });
  $(document).ready(function () {
      $("#formCandidato").on("submit", function (event) {
          event.preventDefault();

          let candidato = {
              nick: $("#nickInput").val().trim()
          };

          console.log("Enviando candidato:", candidato);
          //checaNick(candidato);
        return false;
      });
  });
  </script>
</body>
</html>
